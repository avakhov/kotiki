
function __assert(condition,id){if(id==undefined){__exit("Вызывайте __assert с правильным ID и "+"обновите ASSERT-NEXT-ID в файле utils/utils.js");}
if(!condition){__exit("ASSERT: "+id);}}
function __exit(msg){alert(msg);throw('exit');}
function parse_class(obj,pattern){var list=obj.attr('class').split(/\s+/);var out='';for(var i=0;i<list.length;i++){var re=new RegExp('^'+pattern);if(re.test(list[i])){out=list[i].replace(pattern,'');break;}}
return out;}
function htmlDecode(input){var e=document.createElement('div');e.innerHTML=input;return e.childNodes[0].nodeValue;}
function current_url_for(url,new_parms){var parts=url.split('?');var path=parts[0];var query_string='';if(parts.length>1){query_string=parts[1];}
var parms=query_string.split('&');if(query_string==''){parms=[];}
var keys=get_keys(new_parms);for(var j=0;j<keys.length;j++){var found=false;var name=keys[j];var value=new_parms[name];var arr=[];for(var i=0;i<parms.length;i++){var pair=parms[i].split('=');var parm_name=pair[0];var parm_value=pair[1];if(parm_name==name){if(value=='nil'){}else if(value=='nil_if_not_all'){if(parm_value=='all'){arr.push(parm_name+'='+parm_value);}}else{arr.push(parm_name+'='+value);}
found=true;}else{arr.push(parm_name+'='+parm_value);}}
if(!found&&value!='nil'&&value!='nil_if_not_all'){arr.push(name+'='+value);}
parms=arr;}
return path+"?"+parms.join('&');}
function get_keys(hash)
{var keys=[]
for(i in hash){keys.push(i);}
keys.sort();return keys;}
function get_field(model_name,field_name,selector){return new Field(model_name,field_name,selector);}
function get_fields_by_kind(kind,selector){var query='.field-kind-'+kind;if(selector!=null){query=selector+' '+query;}
var out=[];$(query).each(function(){var model_name=parse_class($(this),'field-model-');var field_name=parse_class($(this),'field-name-');out.push(get_field(model_name,field_name,selector));});return out;}
function Field(model_name,field_name,selector){this.model_name=model_name;this.field_name=field_name;if(selector==null){this.__field=$('#'+model_name+"_"+field_name+"_input");}else if(typeof(selector)=='string'){this.__field=$(selector+' #'+model_name+"_"+field_name+"_input");}else{__assert(false,'a_18 - wrong selector type');}
__assert(this.__field.size()==0||this.__field.size()==1,'a_19')
this.__kind=this.__get_kind();}
Field.prototype.is_valid=function(){return(this.__field.size()==1);}
Field.prototype.get_value=function(){if(this.__field.size()==1){if(this.__kind=="boolean"){return this.__field.find("input[type=checkbox]").attr('checked');}else if(this.__is_enum()){return this.__field.find("select").val();}else{return this.__field.find("input").val();}}else{return null;}}
Field.prototype.set_value=function(value){if(this.__field.size()==1){if(this.__kind=="boolean"){this.__field.find("input[type=checkbox]").attr('checked',value);}else if(this.__kind=="enum"){this.__field.find("select").val(value);}else{this.__field.find("input").val(value);}}}
Field.prototype.get_param=function(name){if(this.is_valid()){var html=this.__field.find(".param-"+name).html();if(html==''){return'';}else{return htmlDecode(html);}}else{return null;}}
Field.prototype.set_param=function(name,value){if(this.is_valid()){return this.__field.find(".param-"+name).html(value);}else{return null;}}
Field.prototype.on_change=function(callback){if(this.__field.size()==1){if(this.__kind=="boolean"){this.__field.find("input[type=checkbox]").change(callback);}else if(this.__is_enum()){this.__field.find("select").change(callback);}else{this.__field.find("input").change(callback);}}}
Field.prototype.ajax_update_node_object_form=function(){if(!this.is_valid()){return;}
var node_object=get_field('node','object');__assert(this.__kind=="sys_node_object_form","a_13 "+this.__kind);__assert(node_object.is_valid(),'a_14');__assert(this.is_valid(),'a_15');var __this=this;var value=node_object.get_value();var url=ajax_node_object_path+'?'+$.param({node_object:value});if(node_object.get_param('value')!=value){__this.__field.html('');node_object.set_param('value',value);ajax_get(url,this.__field,function(data){__this.__field.html(data);});}}
Field.prototype.__get_kind=function(){if(this.is_valid()){return parse_class(this.__field,'field-kind-');}else{return null;}}
Field.prototype.__show_hide=function(show){if(show){this.__field.show();}else{this.__field.hide();}}
Field.prototype.__is_enum=function(show){return(this.__kind=="enum"||this.__kind=='sys_node_object'||this.__kind=='sys_node_multiple_model_class');}
Field.prototype.do_picture=function(){__assert(this.is_valid(),'a_24');var __this=this;upload_file(__this.__field.find('.load_picture_div input[type=file]'),{url:route_ajax_document_path,data:{preview:__this.get_param('preview_name')},session_key:session_key,magic_key:magic_key,magic_value:magic_value,onStart:function(){__this.__field.find('.inline-errors').remove();},onComplete:function(hash){__this.__do_picture__on_complete(hash);}})
__this.__field.find('.clean_picture').click(function(){__this.__field.find('.choosed_picture .preview').remove();__this.__field.find('.clean_picture').hide();__this.__field.find('.load_picture_div').show();__this.__field.find('input[type=hidden].document_id').val('');__this.__field.find('.load_picture_div input[type=file]').val('');__this.__do_picture__fields_show_hide('none');return false;});__this.__field.find(".choose_file_from_existed").click(function(){var url=route_ajax_index_path+'?'+$.param({show_flash:__this.get_param('support_flash')});__this.__do_picture__dialog_choose_file(url,__this.__field.find(".choose_file_from_existed-ajax"),true);return false;});get_field(__this.model_name,__this.field_name+"_flash_width").on_change(function(){__this.set_param('flash_width',parseInt($(this).val()));__this.__do_picture__set_flash_object();});get_field(__this.model_name,__this.field_name+"_flash_height").on_change(function(){__this.set_param('flash_height',parseInt($(this).val()));__this.__do_picture__set_flash_object();});}
Field.prototype.__do_picture__on_complete=function(hash){var div=this.__field.find('.load_picture_div');if(hash['file_type']=='file'||(hash['file_type']=='flash'&&this.get_param('support_flash')=='0')){div.after('<div class="inline-errors">Неизвестный формат картинки</div>');this.__do_picture__fields_show_hide('file');}else if(hash['file_type']=='flash'){this.set_param('flash_url',hash['url'])
this.__field.find('input[type=hidden].document_id').val(hash['id']);this.__do_picture__set_flash_object();}else{var img_html='<img class="preview" src="'+hash['url']+'">';this.__field.find('.choosed_picture .preview').remove();$(img_html).prependTo(this.__field.find('.choosed_picture'));this.__field.find('.clean_picture').css('left',hash['w']+'px');this.__field.find('.clean_picture').show();this.__field.find('input[type=hidden].document_id').val(hash['id']);div.hide();this.__do_picture__fields_show_hide('image');}}
Field.prototype.__do_picture__set_flash_object=function(){this.__field.find('.choosed_picture .preview').remove();var html=flash_html.replace(/%url%/g,this.get_param('flash_url')).replace(/%params%/g,'').replace(/%width%/g,"width='"+this.get_param('flash_width')+"'").replace(/%height%/g,"height='"+this.get_param('flash_height')+"'");this.__field.find('.choosed_picture').prepend("<div class='preview'>"+html+"</div>");this.__field.find('.clean_picture').css('left',this.get_param('flash_width')+'px');this.__field.find('.clean_picture').show();this.__field.find('.load_picture_div').hide();this.__do_picture__fields_show_hide('flash');}
Field.prototype.__do_picture__fields_show_hide=function(file_type){if(this.get_param('support_url')=='1'){get_field(this.model_name,this.field_name+'_image_url').__show_hide(file_type=='image');if(this.get_param('support_url_open_in_new_window')=='1'){get_field(this.model_name,this.field_name+'_image_url_open_in_new_window').__show_hide(file_type=='image');}}
if(this.get_param('support_flash')=='1'&&this.get_param('allow_set_flash_size')){get_field(this.model_name,this.field_name+'_flash_width').__show_hide(file_type=='flash');get_field(this.model_name,this.field_name+'_flash_height').__show_hide(file_type=='flash');}
if(this.get_param('support_flash')=='1'&&this.get_param('allow_set_flash_parms')){get_field(this.model_name,this.field_name+'_flash_parms').__show_hide(file_type=='flash');}}
Field.prototype.__do_picture__dialog_choose_file=function(url,ajax,create_dialog){var div=this.__field.find('.load_picture_div');var __this=this;ajax.show();$.get(url,function(data){ajax.hide();if(create_dialog){$('body').append('<div id="picture_dialog"></div>');}
$('#picture_dialog').html(data);$('#picture_dialog a.folder').click(function(){var id=parseInt($(this).attr('id'));var url=route_ajax_index_path+'?'+$.param({current_folder:id,show_flash:__this.get_param('support_flash')});__this.__do_picture__dialog_choose_file(url,$('#picture_dialog .happy_hack_ajax_mega img'),false);return false;});$('#picture_dialog a.doc, #picture_dialog a.doc-title').click(function(){var id=parseInt($(this).attr('id'));$('#picture_dialog').dialog('destroy');$('#picture_dialog').remove();$.get(route_ajax_document_path+"?"+$.param({id:id,preview:__this.get_param('preview_name')}),function(data){__this.__do_picture__on_complete(eval('('+data+')'));});return false;});if(create_dialog){$('#picture_dialog').dialog({width:'auto',height:'auto',modal:true,close:function(event,ui){$('#picture_dialog').dialog('destroy');$('#picture_dialog').remove();}});}});}
Field.prototype.do_pictures=function(){__assert(this.is_valid(),'a_25');var __this=this;upload_file(__this.__field.find('.load_picture_div input[type=file]'),{url:route_ajax_document_path,data:{preview:__this.get_param('preview_name')},session_key:session_key,magic_key:magic_key,magic_value:magic_value,onStart:function(){__this.__field.find('.inline-errors').remove();},onComplete:function(hash){__this.__do_pictures__on_complete(hash);}});__this.__field.find('.pictures .picture .clean_picture').click(function(){__this.__do_pictures__clean_picture(this);return false;});__this.__field.find(".load_picture_div .choose_file_from_existed").click(function(){var url=route_ajax_index_path;__this.__do_pictures__dialog_choose_file(url,__this.__field.find(".choose_file_from_existed-ajax"),true);return false;});__this.__field.find('.pictures').sortable({start:function(event,ui){ui.placeholder.css('width',(parseInt(__this.get_param('width'))+40)+'px');ui.placeholder.css('height',__this.get_param('height')+'px');},stop:function(event,ui){__this.__do_pictures__calculate_positions();},placeholder:"ui-state-highlight placeholder",cursor:'crosshair',opacity:0.5});__this.__field.find('.pictures').disableSelection();}
Field.prototype.__do_pictures__on_complete=function(hash){var __this=this;if(hash['file_type']=='img'){var html_style="width: "+(parseInt(hash['w'])+40)+"px; height: "+hash['h']+"px; ";var html_class="d"+hash['id']+" picture";var html='';html+='<div class="'+html_class+'" style="'+html_style+'">';html+=this.get_param('close_picture').replace('style-position-left',hash['w']);html+='<img src="'+hash['url']+'">';html+='</div>';$(html).appendTo(this.__field.find('.pictures'));var documents_add=this.__field.find('input[type=hidden].documents_add');var add=documents_add.val();if(add==''){add='d'+hash['id'];}else{add+=',d'+hash['id'];}
documents_add.val(add);__this.__field.find('.pictures .d'+hash['id']+' .clean_picture').click(function(){__this.__do_pictures__clean_picture(this);return false;});}else{this.__field.find('.load_picture_div').after('<div class="inline-errors">Неизвестный формат картинки</div>');}
this.__do_pictures__calculate_positions();}
Field.prototype.__do_pictures__clean_picture=function(link){var document_id=parse_class($(link).parent(),'d');if(document_id==''){var documents_remove=this.__field.find('input[type=hidden].documents_remove');var remove=documents_remove.val();if(remove==''){remove+='k'+parse_class($(link).parent(),'k');}else{remove+=',k'+parse_class($(link).parent(),'k');}
documents_remove.val(remove);}else{var documents_add=this.__field.find('input[type=hidden].documents_add');var add_array=documents_add.val().split(',');var index=0;while(index<add_array.length&&add_array[index]!='d'+document_id){index+=1;}
__assert(index<add_array.length,'a_26');add_array.splice(index,1);documents_add.val(add_array.join(','));}
$(link).parent().remove();}
Field.prototype.__do_pictures__dialog_choose_file=function(url,ajax,create_dialog){var div=this.__field.find('.load_picture_div');var __this=this;ajax.show();$.get(url,function(data){ajax.hide();if(create_dialog){$('body').append('<div id="picture_dialog"></div>');}
$('#picture_dialog').html(data);$('#picture_dialog a.folder').click(function(){var id=parseInt($(this).attr('id'));var url=route_ajax_index_path;__this.__do_pictures__dialog_choose_file(url,$('#picture_dialog .happy_hack_ajax_mega img'),false);return false;});$('#picture_dialog a.doc, #picture_dialog a.doc-title').click(function(){var id=parseInt($(this).attr('id'));$('#picture_dialog').dialog('destroy');$('#picture_dialog').remove();$.get(route_ajax_document_path+"?"+$.param({id:id,preview:__this.get_param('preview_name')}),function(data){__this.__do_pictures__on_complete(eval('('+data+')'));});return false;});if(create_dialog){$('#picture_dialog').dialog({width:'auto',height:'auto',modal:true,close:function(event,ui){$('#picture_dialog').dialog('destroy');$('#picture_dialog').remove();}});}});}
Field.prototype.__do_pictures__calculate_positions=function(){var positions_array=[];var __this=this;this.__field.find('.pictures .picture').each(function(){var id=parse_class($(this),'k');if(id==''){id='d'+parse_class($(this),'d');}else{id='k'+id;}
positions_array.push(id);});this.__field.find('input[type=hidden].documents_position').val(positions_array.join(','));}
Field.prototype.do_attach=function(){__assert(this.is_valid(),'a_27');var __this=this;upload_file(__this.__field.find('.load_doc_div input[type=file]'),{url:route_ajax_document_path,data:{},session_key:session_key,magic_key:magic_key,magic_value:magic_value,onStart:function(){__this.__field.find('.inline-errors').remove();},onComplete:function(hash){__this.__do_attach__on_complete(hash);}});__this.__field.find('.clean_doc').click(function(){__this.__field.find('.ext').html('');__this.__field.find('.clean_doc').hide();__this.__field.find('input[type=text]').val('');__this.__field.find('input[type=text]').attr('disabled','disabled');__this.__field.find('input[type=hidden].attach_id').val('');__this.__field.find('.load_doc_div').show();return false;});}
Field.prototype.__do_attach__on_complete=function(hash){var allow_extentions=this.get_param('allow_extentions');var allow=false;if(allow_extentions==''){allow=true;}else{$.each(allow_extentions.split(' '),function(){if(this==hash['ext']){allow=true;}});}
if(allow){this.__field.find('.ext').html(hash['ext']);this.__field.find('.clean_doc').show();this.__field.find('input[type=text]').val(hash['name']);this.__field.find('input[type=text]').removeAttr('disabled');this.__field.find('input[type=hidden].attach_id').val(hash['id']);this.__field.find('.load_doc_div').hide();}else{this.__field.find('.load_doc_div').after('<div class="inline-errors">Неправильный формат файла</div>');}}
function ajax_get(url,ajax_container,callback){if($.isFunction(ajax_container)){callback=ajax_container;ajax_container=null;}
$.get(url,callback);}
var audioplayer_swfobject=function(){var d="undefined",R="object",s="Shockwave Flash",w="ShockwaveFlash.ShockwaveFlash",Q="application/x-shockwave-flash",r="SWFObjectExprInst",X="onreadystatechange",o=window,J=document,T=navigator,t=false,u=[H],O=[],n=[],i=[],L,q,e,b,j=false,A=false,N,g,M=true,m=function(){var AA=typeof J.getElementById!=d&&typeof J.getElementsByTagName!=d&&typeof J.createElement!=d,AH=T.userAgent.toLowerCase(),y=T.platform.toLowerCase(),AE=y?/win/.test(y):/win/.test(AH),AC=y?/mac/.test(y):/mac/.test(AH),AF=/webkit/.test(AH)?parseFloat(AH.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,x=!+"\v1",AG=[0,0,0],AB=null;if(typeof T.plugins!=d&&typeof T.plugins[s]==R){AB=T.plugins[s].description;if(AB&&!(typeof T.mimeTypes!=d&&T.mimeTypes[Q]&&!T.mimeTypes[Q].enabledPlugin)){t=true;x=false;AB=AB.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AG[0]=parseInt(AB.replace(/^(.*)\..*$/,"$1"),10);AG[1]=parseInt(AB.replace(/^.*\.(.*)\s.*$/,"$1"),10);AG[2]=/[a-zA-Z]/.test(AB)?parseInt(AB.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof o.ActiveXObject!=d){try{var AD=new ActiveXObject(w);if(AD){AB=AD.GetVariable("$version");if(AB){x=true;AB=AB.split(" ")[1].split(",");AG=[parseInt(AB[0],10),parseInt(AB[1],10),parseInt(AB[2],10)]}}}catch(z){}}}return{w3:AA,pv:AG,wk:AF,ie:x,win:AE,mac:AC}}(),K=function(){if(!m.w3){return}if((typeof J.readyState!=d&&J.readyState=="complete")||(typeof J.readyState==d&&(J.getElementsByTagName("body")[0]||J.body))){F()}if(!j){if(typeof J.addEventListener!=d){J.addEventListener("DOMContentLoaded",F,false)}if(m.ie&&m.win){J.attachEvent(X,function(){if(J.readyState=="complete"){J.detachEvent(X,arguments.callee);F()}});if(o==top){(function(){if(j){return}try{J.documentElement.doScroll("left")}catch(x){setTimeout(arguments.callee,0);return}F()})()}}if(m.wk){(function(){if(j){return}if(!/loaded|complete/.test(J.readyState)){setTimeout(arguments.callee,0);return}F()})()}S(F)}}();function F(){if(j){return}try{var z=J.getElementsByTagName("body")[0].appendChild(c("span"));z.parentNode.removeChild(z)}catch(AA){return}j=true;var x=u.length;for(var y=0;y<x;y++){u[y]()}}function k(x){if(j){x()}else{u[u.length]=x}}function S(y){if(typeof o.addEventListener!=d){o.addEventListener("load",y,false)}else{if(typeof J.addEventListener!=d){J.addEventListener("load",y,false)}else{if(typeof o.attachEvent!=d){I(o,"onload",y)}else{if(typeof o.onload=="function"){var x=o.onload;o.onload=function(){x();y()}}else{o.onload=y}}}}}function H(){if(t){v()}else{h()}}function v(){var x=J.getElementsByTagName("body")[0];var AA=c(R);AA.setAttribute("type",Q);var z=x.appendChild(AA);if(z){var y=0;(function(){if(typeof z.GetVariable!=d){var AB=z.GetVariable("$version");if(AB){AB=AB.split(" ")[1].split(",");m.pv=[parseInt(AB[0],10),parseInt(AB[1],10),parseInt(AB[2],10)]}}else{if(y<10){y++;setTimeout(arguments.callee,10);return}}x.removeChild(AA);z=null;h()})()}else{h()}}function h(){var AG=O.length;if(AG>0){for(var AF=0;AF<AG;AF++){var y=O[AF].id;var AB=O[AF].callbackFn;var AA={success:false,id:y};if(m.pv[0]>0){var AE=C(y);if(AE){if(f(O[AF].swfVersion)&&!(m.wk&&m.wk<312)){W(y,true);if(AB){AA.success=true;AA.ref=Z(y);AB(AA)}}else{if(O[AF].expressInstall&&a()){var AI={};AI.data=O[AF].expressInstall;AI.width=AE.getAttribute("width")||"0";AI.height=AE.getAttribute("height")||"0";if(AE.getAttribute("class")){AI.styleclass=AE.getAttribute("class")}if(AE.getAttribute("align")){AI.align=AE.getAttribute("align")}var AH={};var x=AE.getElementsByTagName("param");var AC=x.length;for(var AD=0;AD<AC;AD++){if(x[AD].getAttribute("name").toLowerCase()!="movie"){AH[x[AD].getAttribute("name")]=x[AD].getAttribute("value")}}p(AI,AH,y,AB)}else{P(AE);if(AB){AB(AA)}}}}}else{W(y,true);if(AB){var z=Z(y);if(z&&typeof z.SetVariable!=d){AA.success=true;AA.ref=z}AB(AA)}}}}}function Z(AA){var x=null;var y=C(AA);if(y&&y.nodeName=="OBJECT"){if(typeof y.SetVariable!=d){x=y}else{var z=y.getElementsByTagName(R)[0];if(z){x=z}}}return x}function a(){return!A&&f("6.0.65")&&(m.win||m.mac)&&!(m.wk&&m.wk<312)}function p(AA,AB,x,z){A=true;e=z||null;b={success:false,id:x};var AE=C(x);if(AE){if(AE.nodeName=="OBJECT"){L=G(AE);q=null}else{L=AE;q=x}AA.id=r;if(typeof AA.width==d||(!/%$/.test(AA.width)&&parseInt(AA.width,10)<310)){AA.width="310"}if(typeof AA.height==d||(!/%$/.test(AA.height)&&parseInt(AA.height,10)<137)){AA.height="137"}J.title=J.title.slice(0,47)+" - Flash Player Installation";var AD=m.ie&&m.win?"ActiveX":"PlugIn",AC="MMredirectURL="+o.location.toString().replace(/&/g,"%26")+"&MMplayerType="+AD+"&MMdoctitle="+J.title;if(typeof AB.flashvars!=d){AB.flashvars+="&"+AC}else{AB.flashvars=AC}if(m.ie&&m.win&&AE.readyState!=4){var y=c("div");x+="SWFObjectNew";y.setAttribute("id",x);AE.parentNode.insertBefore(y,AE);AE.style.display="none";(function(){if(AE.readyState==4){AE.parentNode.removeChild(AE)}else{setTimeout(arguments.callee,10)}})()}U(AA,AB,x)}}function P(y){if(m.ie&&m.win&&y.readyState!=4){var x=c("div");y.parentNode.insertBefore(x,y);x.parentNode.replaceChild(G(y),x);y.style.display="none";(function(){if(y.readyState==4){y.parentNode.removeChild(y)}else{setTimeout(arguments.callee,10)}})()}else{y.parentNode.replaceChild(G(y),y)}}function G(AB){var AA=c("div");if(m.win&&m.ie){AA.innerHTML=AB.innerHTML}else{var y=AB.getElementsByTagName(R)[0];if(y){var AC=y.childNodes;if(AC){var x=AC.length;for(var z=0;z<x;z++){if(!(AC[z].nodeType==1&&AC[z].nodeName=="PARAM")&&!(AC[z].nodeType==8)){AA.appendChild(AC[z].cloneNode(true))}}}}}return AA}function U(AI,AG,y){var x,AA=C(y);if(m.wk&&m.wk<312){return x}if(AA){if(typeof AI.id==d){AI.id=y}if(m.ie&&m.win){var AH="";for(var AE in AI){if(AI[AE]!=Object.prototype[AE]){if(AE.toLowerCase()=="data"){AG.movie=AI[AE]}else{if(AE.toLowerCase()=="styleclass"){AH+=' class="'+AI[AE]+'"'}else{if(AE.toLowerCase()!="classid"){AH+=" "+AE+'="'+AI[AE]+'"'}}}}}var AF="";for(var AD in AG){if(AG[AD]!=Object.prototype[AD]){AF+='<param name="'+AD+'" value="'+AG[AD]+'" />'}}AA.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AH+">"+AF+"</object>";n[n.length]=AI.id;x=C(AI.id)}else{var z=c(R);z.setAttribute("type",Q);for(var AC in AI){if(AI[AC]!=Object.prototype[AC]){if(AC.toLowerCase()=="styleclass"){z.setAttribute("class",AI[AC])}else{if(AC.toLowerCase()!="classid"){z.setAttribute(AC,AI[AC])}}}}for(var AB in AG){if(AG[AB]!=Object.prototype[AB]&&AB.toLowerCase()!="movie"){E(z,AB,AG[AB])}}AA.parentNode.replaceChild(z,AA);x=z}}return x}function E(z,x,y){var AA=c("param");AA.setAttribute("name",x);AA.setAttribute("value",y);z.appendChild(AA)}function Y(y){var x=C(y);if(x&&x.nodeName=="OBJECT"){if(m.ie&&m.win){x.style.display="none";(function(){if(x.readyState==4){B(y)}else{setTimeout(arguments.callee,10)}})()}else{x.parentNode.removeChild(x)}}}function B(z){var y=C(z);if(y){for(var x in y){if(typeof y[x]=="function"){y[x]=null}}y.parentNode.removeChild(y)}}function C(z){var x=null;try{x=J.getElementById(z)}catch(y){}return x}function c(x){return J.createElement(x)}function I(z,x,y){z.attachEvent(x,y);i[i.length]=[z,x,y]}function f(z){var y=m.pv,x=z.split(".");x[0]=parseInt(x[0],10);x[1]=parseInt(x[1],10)||0;x[2]=parseInt(x[2],10)||0;return(y[0]>x[0]||(y[0]==x[0]&&y[1]>x[1])||(y[0]==x[0]&&y[1]==x[1]&&y[2]>=x[2]))?true:false}function V(AC,y,AD,AB){if(m.ie&&m.mac){return}var AA=J.getElementsByTagName("head")[0];if(!AA){return}var x=(AD&&typeof AD=="string")?AD:"screen";if(AB){N=null;g=null}if(!N||g!=x){var z=c("style");z.setAttribute("type","text/css");z.setAttribute("media",x);N=AA.appendChild(z);if(m.ie&&m.win&&typeof J.styleSheets!=d&&J.styleSheets.length>0){N=J.styleSheets[J.styleSheets.length-1]}g=x}if(m.ie&&m.win){if(N&&typeof N.addRule==R){N.addRule(AC,y)}}else{if(N&&typeof J.createTextNode!=d){N.appendChild(J.createTextNode(AC+" {"+y+"}"))}}}function W(z,x){if(!M){return}var y=x?"visible":"hidden";if(j&&C(z)){C(z).style.visibility=y}else{V("#"+z,"visibility:"+y)}}function l(y){var z=/[\\\"<>\.;]/;var x=z.exec(y)!=null;return x&&typeof encodeURIComponent!=d?encodeURIComponent(y):y}var D=function(){if(m.ie&&m.win){window.attachEvent("onunload",function(){var AC=i.length;for(var AB=0;AB<AC;AB++){i[AB][0].detachEvent(i[AB][1],i[AB][2])}var z=n.length;for(var AA=0;AA<z;AA++){Y(n[AA])}for(var y in m){m[y]=null}m=null;for(var x in audioplayer_swfobject){audioplayer_swfobject[x]=null}audioplayer_swfobject=null})}}();return{registerObject:function(AB,x,AA,z){if(m.w3&&AB&&x){var y={};y.id=AB;y.swfVersion=x;y.expressInstall=AA;y.callbackFn=z;O[O.length]=y;W(AB,false)}else{if(z){z({success:false,id:AB})}}},getObjectById:function(x){if(m.w3){return Z(x)}},embedSWF:function(AB,AH,AE,AG,y,AA,z,AD,AF,AC){var x={success:false,id:AH};if(m.w3&&!(m.wk&&m.wk<312)&&AB&&AH&&AE&&AG&&y){W(AH,false);k(function(){AE+="";AG+="";var AJ={};if(AF&&typeof AF===R){for(var AL in AF){AJ[AL]=AF[AL]}}AJ.data=AB;AJ.width=AE;AJ.height=AG;var AM={};if(AD&&typeof AD===R){for(var AK in AD){AM[AK]=AD[AK]}}if(z&&typeof z===R){for(var AI in z){if(typeof AM.flashvars!=d){AM.flashvars+="&"+AI+"="+z[AI]}else{AM.flashvars=AI+"="+z[AI]}}}if(f(y)){var AN=U(AJ,AM,AH);if(AJ.id==AH){W(AH,true)}x.success=true;x.ref=AN}else{if(AA&&a()){AJ.data=AA;p(AJ,AM,AH,AC);return}else{W(AH,true)}}if(AC){AC(x)}})}else{if(AC){AC(x)}}},switchOffAutoHideShow:function(){M=false},ua:m,getFlashPlayerVersion:function(){return{major:m.pv[0],minor:m.pv[1],release:m.pv[2]}},hasFlashPlayerVersion:f,createSWF:function(z,y,x){if(m.w3){return U(z,y,x)}else{return undefined}},showExpressInstall:function(z,AA,x,y){if(m.w3&&a()){p(z,AA,x,y)}},removeSWF:function(x){if(m.w3){Y(x)}},createCSS:function(AA,z,y,x){if(m.w3){V(AA,z,y,x)}},addDomLoadEvent:k,addLoadEvent:S,getQueryParamValue:function(AA){var z=J.location.search||J.location.hash;if(z){if(/\?/.test(z)){z=z.split("?")[1]}if(AA==null){return l(z)}var y=z.split("&");for(var x=0;x<y.length;x++){if(y[x].substring(0,y[x].indexOf("="))==AA){return l(y[x].substring((y[x].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(A){var x=C(r);if(x&&L){x.parentNode.replaceChild(L,x);if(q){W(q,true);if(m.ie&&m.win){L.style.display="block"}}if(e){e(b)}}A=false}}}}();var AudioPlayer=function(){var H=[];var D;var F="";var A={};var E=-1;var G="9";function B(I){if(document.all&&!window[I]){for(var J=0;J<document.forms.length;J++){if(document.forms[J][I]){return document.forms[J][I];break}}}return document.all?window[I]:document[I]}function C(I,J,K){B(I).addListener(J,K)}return{setup:function(J,I){F=J;A=I;if(audioplayer_swfobject.hasFlashPlayerVersion(G)){audioplayer_swfobject.switchOffAutoHideShow();audioplayer_swfobject.createCSS("p.audioplayer_container span","visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;")}},getPlayer:function(I){return B(I)},addListener:function(I,J,K){C(I,J,K)},embed:function(I,K){var N={};var L;var J={};var O={};var M={};for(L in A){N[L]=A[L]}for(L in K){N[L]=K[L]}if(N.transparentpagebg=="yes"){J.bgcolor="#FFFFFF";J.wmode="transparent"}else{if(N.pagebg){J.bgcolor="#"+N.pagebg}J.wmode="opaque"}J.menu="false";for(L in N){if(L=="pagebg"||L=="width"||L=="transparentpagebg"){continue}O[L]=N[L]}M.name=I;M.style="outline: none";O.playerID=I;audioplayer_swfobject.embedSWF(F,I,N.width.toString(),"24",G,false,O,J,M);H.push(I)},syncVolumes:function(I,K){E=K;for(var J=0;J<H.length;J++){if(H[J]!=I){B(H[J]).setVolume(E)}}},activate:function(I,J){if(D&&D!=I){B(D).close()}D=I},load:function(K,I,L,J){B(K).load(I,L,J)},close:function(I){B(I).close();if(I==D){D=null}},open:function(I,J){if(J==undefined){J=1}B(I).open(J==undefined?0:J-1)},getVolume:function(I){return E}}}();var sprintf=(function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase();}
function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}
return output.join('');}
var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0]);}
return str_format.format.call(null,str_format.cache[arguments[0]],arguments);};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type='',arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==='string'){output.push(parse_tree[i]);}
else if(node_type==='array'){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw(sprintf('[sprintf] property "%s" does not exist',match[2][k]));}
arg=arg[match[2][k]];}}
else if(match[1]){arg=argv[match[1]];}
else{arg=argv[cursor++];}
if(/[^s]/.test(match[8])&&(get_type(arg)!='number')){throw(sprintf('[sprintf] expecting number but found %s',get_type(arg)));}
switch(match[8]){case'b':arg=arg.toString(2);break;case'c':arg=String.fromCharCode(arg);break;case'd':arg=parseInt(arg,10);break;case'e':arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case'f':arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case'o':arg=arg.toString(8);break;case's':arg=((arg=String(arg))&&match[7]?arg.substring(0,match[7]):arg);break;case'u':arg=Math.abs(arg);break;case'x':arg=arg.toString(16);break;case'X':arg=arg.toString(16).toUpperCase();break;}
arg=(/[def]/.test(match[8])&&match[3]&&arg>=0?'+'+arg:arg);pad_character=match[4]?match[4]=='0'?'0':match[4].charAt(1):' ';pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):'';output.push(match[5]?arg+pad:pad+arg);}}
return output.join('');};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0]);}
else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push('%');}
else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==''){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1]);}
else{throw('[sprintf] huh?');}}}
else{throw('[sprintf] huh?');}
match[2]=field_list;}
else{arg_names|=2;}
if(arg_names===3){throw('[sprintf] mixing positional and named placeholders is not (yet) supported');}
parse_tree.push(match);}
else{throw('[sprintf] huh?');}
_fmt=_fmt.substring(match[0].length);}
return parse_tree;};return str_format;})();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv);};eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}(';(8($){j e={},9,m,B,A=$.2u.2g&&/29\\s(5\\.5|6\\.)/.1M(1H.2t),M=12;$.k={w:12,1h:{Z:25,r:12,1d:19,X:"",G:15,E:15,16:"k"},2s:8(){$.k.w=!$.k.w}};$.N.1v({k:8(a){a=$.1v({},$.k.1h,a);1q(a);g 2.F(8(){$.1j(2,"k",a);2.11=e.3.n("1g");2.13=2.m;$(2).24("m");2.22=""}).21(1e).1U(q).1S(q)},H:A?8(){g 2.F(8(){j b=$(2).n(\'Y\');4(b.1J(/^o\\(["\']?(.*\\.1I)["\']?\\)$/i)){b=1F.$1;$(2).n({\'Y\':\'1D\',\'1B\':"2r:2q.2m.2l(2j=19, 2i=2h, 1p=\'"+b+"\')"}).F(8(){j a=$(2).n(\'1o\');4(a!=\'2f\'&&a!=\'1u\')$(2).n(\'1o\',\'1u\')})}})}:8(){g 2},1l:A?8(){g 2.F(8(){$(2).n({\'1B\':\'\',Y:\'\'})})}:8(){g 2},1x:8(){g 2.F(8(){$(2)[$(2).D()?"l":"q"]()})},o:8(){g 2.1k(\'28\')||2.1k(\'1p\')}});8 1q(a){4(e.3)g;e.3=$(\'<t 16="\'+a.16+\'"><10></10><t 1i="f"></t><t 1i="o"></t></t>\').27(K.f).q();4($.N.L)e.3.L();e.m=$(\'10\',e.3);e.f=$(\'t.f\',e.3);e.o=$(\'t.o\',e.3)}8 7(a){g $.1j(a,"k")}8 1f(a){4(7(2).Z)B=26(l,7(2).Z);p l();M=!!7(2).M;$(K.f).23(\'W\',u);u(a)}8 1e(){4($.k.w||2==9||(!2.13&&!7(2).U))g;9=2;m=2.13;4(7(2).U){e.m.q();j a=7(2).U.1Z(2);4(a.1Y||a.1V){e.f.1c().T(a)}p{e.f.D(a)}e.f.l()}p 4(7(2).18){j b=m.1T(7(2).18);e.m.D(b.1R()).l();e.f.1c();1Q(j i=0,R;(R=b[i]);i++){4(i>0)e.f.T("<1P/>");e.f.T(R)}e.f.1x()}p{e.m.D(m).l();e.f.q()}4(7(2).1d&&$(2).o())e.o.D($(2).o().1O(\'1N://\',\'\')).l();p e.o.q();e.3.P(7(2).X);4(7(2).H)e.3.H();1f.1L(2,1K)}8 l(){B=S;4((!A||!$.N.L)&&7(9).r){4(e.3.I(":17"))e.3.Q().l().O(7(9).r,9.11);p e.3.I(\':1a\')?e.3.O(7(9).r,9.11):e.3.1G(7(9).r)}p{e.3.l()}u()}8 u(c){4($.k.w)g;4(c&&c.1W.1X=="1E"){g}4(!M&&e.3.I(":1a")){$(K.f).1b(\'W\',u)}4(9==S){$(K.f).1b(\'W\',u);g}e.3.V("z-14").V("z-1A");j b=e.3[0].1z;j a=e.3[0].1y;4(c){b=c.2o+7(9).E;a=c.2n+7(9).G;j d=\'1w\';4(7(9).2k){d=$(C).1r()-b;b=\'1w\'}e.3.n({E:b,14:d,G:a})}j v=z(),h=e.3[0];4(v.x+v.1s<h.1z+h.1n){b-=h.1n+20+7(9).E;e.3.n({E:b+\'1C\'}).P("z-14")}4(v.y+v.1t<h.1y+h.1m){a-=h.1m+20+7(9).G;e.3.n({G:a+\'1C\'}).P("z-1A")}}8 z(){g{x:$(C).2e(),y:$(C).2d(),1s:$(C).1r(),1t:$(C).2p()}}8 q(a){4($.k.w)g;4(B)2c(B);9=S;j b=7(2);8 J(){e.3.V(b.X).q().n("1g","")}4((!A||!$.N.L)&&b.r){4(e.3.I(\':17\'))e.3.Q().O(b.r,0,J);p e.3.Q().2b(b.r,J)}p J();4(7(2).H)e.3.1l()}})(2a);',62,155,'||this|parent|if|||settings|function|current||||||body|return|||var|tooltip|show|title|css|url|else|hide|fade||div|update||blocked|||viewport|IE|tID|window|html|left|each|top|fixPNG|is|complete|document|bgiframe|track|fn|fadeTo|addClass|stop|part|null|append|bodyHandler|removeClass|mousemove|extraClass|backgroundImage|delay|h3|tOpacity|false|tooltipText|right||id|animated|showBody|true|visible|unbind|empty|showURL|save|handle|opacity|defaults|class|data|attr|unfixPNG|offsetHeight|offsetWidth|position|src|createHelper|width|cx|cy|relative|extend|auto|hideWhenEmpty|offsetTop|offsetLeft|bottom|filter|px|none|OPTION|RegExp|fadeIn|navigator|png|match|arguments|apply|test|http|replace|br|for|shift|click|split|mouseout|jquery|target|tagName|nodeType|call||mouseover|alt|bind|removeAttr|200|setTimeout|appendTo|href|MSIE|jQuery|fadeOut|clearTimeout|scrollTop|scrollLeft|absolute|msie|crop|sizingMethod|enabled|positionLeft|AlphaImageLoader|Microsoft|pageY|pageX|height|DXImageTransform|progid|block|userAgent|browser'.split('|'),0,{}))
var opts_lightbox;$.fn.lightbox=function(options){opts_lightbox=$.extend({},$.fn.lightbox.defaults,options);$.fn.lightbox.initialize();return this.each(function(){$(this).click(function(){$(this).lightbox.start(this);return false;});});};$.fn.lightbox.initialize=function(){$('#overlay').remove();$('#lightbox').remove();opts_lightbox.inprogress=false;var outerImage='<div id="outerImageContainer"><div id="imageContainer"><iframe id="lightboxIframe" /><img id="lightboxImage"><div id="hoverNav"><a href="javascript://" title="'+opts_lightbox.strings.prevLinkTitle+'" id="prevLink"></a><a href="javascript://" id="nextLink" title="'+opts_lightbox.strings.nextLinkTitle+'"></a></div><div id="loading"><a href="javascript://" id="loadingLink"><img src="'+opts_lightbox.fileLoadingImage+'"></a></div></div></div>';var imageData='<div id="imageDataContainer" class="clearfix"><div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav">';if(opts_lightbox.displayHelp)
imageData+='<span id="helpDisplay">'+opts_lightbox.strings.help+'</span>';imageData+='<a href="javascript://" id="bottomNavClose" title="'+opts_lightbox.strings.closeTitle+'"><img src="'+opts_lightbox.fileBottomNavCloseImage+'"></a></div></div></div>';var string;if(opts_lightbox.navbarOnTop){string='<div id="overlay"></div><div id="lightbox">'+imageData+outerImage+'</div>';$("body").append(string);$("#imageDataContainer").addClass('ontop');}else{string='<div id="overlay"></div><div id="lightbox">'+outerImage+imageData+'</div>';$("body").append(string);}
$("#overlay").click(function(){$.fn.lightbox.end();}).hide();$("#lightbox").click(function(){$.fn.lightbox.end();}).hide();$("#loadingLink").click(function(){$.fn.lightbox.end();return false;});$("#bottomNavClose").click(function(){$.fn.lightbox.end();return false;});$('#outerImageContainer').width(opts_lightbox.widthCurrent).height(opts_lightbox.heightCurrent);$('#imageDataContainer').width(opts_lightbox.widthCurrent);};$.fn.lightbox.getPageSize=function(){var jqueryPageSize=new Array($(document).width(),$(document).height(),$(window).width(),$(window).height());return jqueryPageSize;};$.fn.lightbox.getPageScroll=function(){var xScroll,yScroll;if(self.pageYOffset){yScroll=self.pageYOffset;xScroll=self.pageXOffset;}else if(document.documentElement&&document.documentElement.scrollTop){yScroll=document.documentElement.scrollTop;xScroll=document.documentElement.scrollLeft;}else if(document.body){yScroll=document.body.scrollTop;xScroll=document.body.scrollLeft;}
var arrayPageScroll=new Array(xScroll,yScroll);return arrayPageScroll;};$.fn.lightbox.pause=function(ms){var date=new Date();var curDate=null;do{curDate=new Date();}
while(curDate-date<ms);};$.fn.lightbox.start=function(imageLink){$("select, embed, object").hide();var arrayPageSize=$.fn.lightbox.getPageSize();$("#overlay").hide().css({width:'100%',height:arrayPageSize[1]+'px',opacity:opts_lightbox.overlayOpacity}).fadeIn();opts_lightbox.imageArray=[];imageNum=0;if(!imageLink.rel||(imageLink.rel=='')){opts_lightbox.imageArray.push(new Array(imageLink.href,opts_lightbox.displayTitle?imageLink.title:''));}else{$("a").each(function(){if(this.href&&(this.rel==imageLink.rel)){opts_lightbox.imageArray.push(new Array(this.href,opts_lightbox.displayTitle?this.title:''));}});for(i=0;i<opts_lightbox.imageArray.length;i++){for(j=opts_lightbox.imageArray.length-1;j>i;j--){if(opts_lightbox.imageArray[i][0]==opts_lightbox.imageArray[j][0]){opts_lightbox.imageArray.splice(j,1);}}}
while(opts_lightbox.imageArray[imageNum][0]!=imageLink.href){imageNum++;}}
var arrayPageScroll=$.fn.lightbox.getPageScroll();var lightboxTop=arrayPageScroll[1]+(arrayPageSize[3]/10);var lightboxLeft=arrayPageScroll[0];$('#lightbox').css({top:lightboxTop+'px',left:lightboxLeft+'px'}).show();if(!opts_lightbox.slideNavBar)
$('#imageData').hide();$.fn.lightbox.changeImage(imageNum);};$.fn.lightbox.changeImage=function(imageNum){if(opts_lightbox.inprogress==false){opts_lightbox.inprogress=true;opts_lightbox.activeImage=imageNum;$('#loading').show();$('#lightboxImage').hide();$('#hoverNav').hide();$('#prevLink').hide();$('#nextLink').hide();if(opts_lightbox.slideNavBar){$('#imageDataContainer').hide();$('#imageData').hide();$.fn.doChangeImage();}else{$.fn.doChangeImage();}}};$.fn.doChangeImage=function(){imgPreloader=new Image();imgPreloader.onload=function(){var newWidth=imgPreloader.width;var newHeight=imgPreloader.height;if(opts_lightbox.fitToScreen){var arrayPageSize=$.fn.lightbox.getPageSize();var ratio;var initialPageWidth=arrayPageSize[2]-2*opts_lightbox.borderSize;var initialPageHeight=arrayPageSize[3]-200;if(imgPreloader.height>initialPageHeight)
{newWidth=parseInt((initialPageHeight/imgPreloader.height)*imgPreloader.width);newHeight=initialPageHeight;}
else if(imgPreloader.width>initialPageWidth)
{newHeight=parseInt((initialPageWidth/imgPreloader.width)*imgPreloader.height);newWidth=initialPageWidth;}}
$('#lightboxImage').attr('src',opts_lightbox.imageArray[opts_lightbox.activeImage][0]).width(newWidth).height(newHeight);$.fn.lightbox.resizeImageContainer(newWidth,newHeight);};imgPreloader.src=opts_lightbox.imageArray[opts_lightbox.activeImage][0];};$.fn.lightbox.end=function(){$.fn.lightbox.disableKeyboardNav();$('#lightbox').hide();$('#overlay').fadeOut();$('select, object, embed').show();};$.fn.lightbox.preloadNeighborImages=function(){if((opts_lightbox.imageArray.length-1)>opts_lightbox.activeImage){preloadNextImage=new Image();preloadNextImage.src=opts_lightbox.imageArray[opts_lightbox.activeImage+1][0];}
if(opts_lightbox.activeImage>0){preloadPrevImage=new Image();preloadPrevImage.src=opts_lightbox.imageArray[opts_lightbox.activeImage-1][0];}};$.fn.lightbox.keyboardAction=function(e){if(e==null){var keycode=event.keyCode;var escapeKey=27;}else{var keycode=e.keyCode;var escapeKey=e.DOM_VK_ESCAPE;}
var key=String.fromCharCode(keycode).toLowerCase();if((key=='x')||(key=='o')||(key=='c')||(keycode==escapeKey)){$.fn.lightbox.end();}else if((key=='p')||(keycode==37)){if(opts_lightbox.activeImage!=0){$.fn.lightbox.disableKeyboardNav();$.fn.lightbox.changeImage(opts_lightbox.activeImage-1);}}else if((key=='n')||(keycode==39)){if(opts_lightbox.activeImage!=(opts_lightbox.imageArray.length-1)){$.fn.lightbox.disableKeyboardNav();$.fn.lightbox.changeImage(opts_lightbox.activeImage+1);}}};$.fn.lightbox.resizeImageContainer=function(imgWidth,imgHeight){opts_lightbox.widthCurrent=document.getElementById('outerImageContainer').offsetWidth;opts_lightbox.heightCurrent=document.getElementById('outerImageContainer').offsetHeight;var widthNew=(imgWidth+(opts_lightbox.borderSize*2));var heightNew=(imgHeight+(opts_lightbox.borderSize*2));opts_lightbox.xScale=(widthNew/opts_lightbox.widthCurrent)*100;opts_lightbox.yScale=(heightNew/opts_lightbox.heightCurrent)*100;wDiff=opts_lightbox.widthCurrent-widthNew;hDiff=opts_lightbox.heightCurrent-heightNew;$('#imageDataContainer').animate({width:widthNew},opts_lightbox.resizeSpeed,'linear');$('#outerImageContainer').animate({width:widthNew},opts_lightbox.resizeSpeed,'linear',function(){$('#outerImageContainer').animate({height:heightNew},opts_lightbox.resizeSpeed,'linear',function(){$.fn.lightbox.showImage();});});if((hDiff==0)&&(wDiff==0)){if(jQuery.browser.msie){$.fn.lightbox.pause(250);}else{$.fn.lightbox.pause(100);}}
$('#prevLink').height(imgHeight);$('#nextLink').height(imgHeight);};$.fn.lightbox.showImage=function(){$('#loading').hide();$('#lightboxImage').fadeIn("fast");$.fn.lightbox.updateDetails();$.fn.lightbox.preloadNeighborImages();opts_lightbox.inprogress=false;};$.fn.lightbox.updateDetails=function(){$('#numberDisplay').html('');if(opts_lightbox.imageArray[opts_lightbox.activeImage][1]){$('#caption').html(opts_lightbox.imageArray[opts_lightbox.activeImage][1]).show();}
if(opts_lightbox.imageArray.length>1){var nav_html;nav_html=opts_lightbox.strings.image+" "+(opts_lightbox.activeImage+1)+opts_lightbox.strings.of+opts_lightbox.imageArray.length;if((opts_lightbox.activeImage)>0){nav_html='<a title="'+opts_lightbox.strings.prevLinkTitle+'" href="#" id="prevLinkText">'+opts_lightbox.strings.prevLinkText+"</a>"+nav_html;}
if((opts_lightbox.activeImage+1)<opts_lightbox.imageArray.length){nav_html+='<a title="'+opts_lightbox.strings.nextLinkTitle+'" href="#" id="nextLinkText">'+opts_lightbox.strings.nextLinkText+"</a>";}
$('#numberDisplay').html(nav_html).show();}
if(opts_lightbox.slideNavBar){$("#imageData").slideDown(opts_lightbox.navBarSlideSpeed);}else{$("#imageData").show();}
var arrayPageSize=$.fn.lightbox.getPageSize();$('#overlay').height(arrayPageSize[1]);$.fn.lightbox.updateNav();};$.fn.lightbox.updateNav=function(){if(opts_lightbox.imageArray.length>1){$('#hoverNav').show();if(opts_lightbox.activeImage!=0){$('#prevLink,#prevLinkText').show().click(function(){$.fn.lightbox.changeImage(opts_lightbox.activeImage-1);return false;});}
if(opts_lightbox.activeImage!=(opts_lightbox.imageArray.length-1)){$('#nextLink,#nextLinkText').show().click(function(){$.fn.lightbox.changeImage(opts_lightbox.activeImage+1);return false;});}
$.fn.lightbox.enableKeyboardNav();}};$.fn.lightbox.enableKeyboardNav=function(){document.onkeydown=$.fn.lightbox.keyboardAction;};$.fn.lightbox.disableKeyboardNav=function(){document.onkeydown='';};$.fn.lightbox.defaults={fileLoadingImage:'/images/jquery/lightbox-loading.gif',fileBottomNavCloseImage:'/images/jquery/lightbox-closelabel.gif',overlayOpacity:0.8,borderSize:10,imageArray:new Array,activeImage:null,inprogress:false,resizeSpeed:350,widthCurrent:250,heightCurrent:250,xScale:1,yScale:1,displayTitle:true,navbarOnTop:false,slideNavBar:false,navBarSlideSpeed:350,displayHelp:false,strings:{help:'',prevLinkTitle:'предыдущая фотография',nextLinkTitle:'следующая фотография',prevLinkText:'&laquo; Пред',nextLinkText:'След &raquo;',closeTitle:'Закрыть',image:'Фото',of:' из '},fitToScreen:true};$(function(){custom_init_js();});function custom_init_js()
{custom_once();custom_apply('');}
function custom_once()
{$('.footnotes ul li.li a').click(function(){var cl=$(this).attr('class');var show_panel=true;if($('.footnotes .'+cl+'-panel').css("display")=="block"){show_panel=false;}
$('.footnotes .panel').hide();if(show_panel){$('.footnotes .'+cl+'-panel').show();}
return false;});jQuery.ajaxSetup({'beforeSend':function(xhr){xhr.setRequestHeader("Accept","text/javascript")}});if($.isFunction($.fn.media))
{$.fn.media.defaults.flvPlayer='/samples/mediaplayer.swf'
$.fn.media.defaults.mp3Player='/samples/mediaplayer.swf'}
$('li.catering_city select').change(function(){set_catering_city_fields($(this).parent());});$('li.catering_city').each(function(){set_catering_city_fields($(this));});var search_form=$('form.search input[name=q]');search_form.val('');set_word_search(search_form);search_form.focus(function(){clean_word_search(search_form);});search_form.blur(function(){set_word_search(search_form);});}
function set_word_search(selector){if(selector.val()==''){selector.css('font-style','italic');selector.css('color','#999');selector.val('Поиск');}}
function clean_word_search(selector){if(selector.css('font-style')=='italic'){selector.val('');selector.css('font-style','normal');selector.css('color','black');}}
function custom_apply(selector)
{if($.isFunction($.fn.tooltip)){$(selector+'.tooltip').tooltip({showURL:false});}
if($.isFunction($.fn.media)){$(selector+'a.media-audio').media({width:300,height:20});$(selector+'a.media-video').media();}
if($.isFunction($.fn.lightbox)){$(".lightbox").lightbox({fileBottomNavCloseImage:'/images/jquery/lightbox-closelabel.ru.gif',strings:{help:'',prevLinkTitle:'предыдущая фотография',nextLinkTitle:'следующая фотография',prevLinkText:'&laquo; Пред',nextLinkText:'След &raquo;',closeTitle:'Закрыть',image:'Фото',of:' из '}});}}
function set_catering_city_fields(selector){var id=selector.attr('id').replace('_num_','_other_');if(selector.find('select').val()==other_catering_city){$('#'+id).removeClass('display-none');}else{$('#'+id).addClass('display-none');}}
function queries_toogle(type,id){s=document.getElementById('q'+type+'_'+id).style
s.display=(s.display!='block')?'block':'none'}